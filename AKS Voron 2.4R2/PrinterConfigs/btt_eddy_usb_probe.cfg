#!SECTION AKS Voron 2.4 R2 
# Eddy Probe, USB Mode
#!SECTION
#USB Serial Id
# Serial ID :

#TODO - Note on Offsets: You must measure the physical distance from your Nozzle tip to the Center of the Eddy unit.

If Eddy is behind nozzle, Y is positive.

If Eddy is left of nozzle, X is negative

[mcu eddy]
#serial: /dev/serial/by-id/usb-Klipper_rp2040_YOUR_ID_HERE # Paste your ID
serial: /dev/serial/by-id/usb-Klipper_rp2040_eddy-if00 

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
z_offset: 2.0 # Placeholder, we calibrate this later
i2c_mcu: eddy
i2c_bus: i2c0f
x_offset: 0 # MEASURE THIS! Distance from nozzle to probe center
y_offset: 20 # MEASURE THIS! Distance from nozzle to probe center
data_rate: 500


#Bed Mesh (The "Scan" Mode)
#Eddy shines here. It scans the bed without stopping ("Rapid Scan").
[bed_mesh]
speed: 200
horizontal_move_z: 2
mesh_min: 30, 30    # Update based on your bed size & probe offsets
mesh_max: 270, 270  # Update based on your bed size & probe offsets
probe_count: 15, 15 # Go high density!
algorithm: bicubic
scan_overshoot: 8  # unique to rapid scanning

#Safe Z Homing
[safe_z_home]
home_xy_position: 150, 150 # Center of your bed
z_hop: 10
z_hop_speed: 25
speed: 200

#!SECTION   This section deals with what to do next to use eddy Probe
#Note on Offsets: You must measure the physical distance from your Nozzle tip to the Center of the Eddy unit.
#If Eddy is behind nozzle, Y is positive.
#If Eddy is left of nozzle, X is negative.
#2. Virtual Z Endstop
#Change [stepper_z] to use the Eddy as the endstop.
#Code snippet

# [stepper_z]
# endstop_pin: probe:z_virtual_endstop
# osition_endstop: 0 # Comment this out
# homing_retract_dist: 0 # Eddy does not need to retract and click like a switch
# homing_speed: 10
# second_homing_speed: 10


#!SECTION End

#!SECTION Phase 5: Calibration (The Essential Steps)

# . Set Current In console:

# LDC1612_SET_CURRENT CURRENT=15
# 2. Frequency Calibrate Move toolhead to center, Z=20mm. Bed Cold.

# PROBE_EDDY_CURRENT_CALIBRATE CHIP=btt_eddy
# SAVE_CONFIG
# 3. Temperature Drift Calibration (REQUIRED) Eddy sensors drift as they heat up. Klipper needs to map this.

# Download the eddy-drift.cfg or macro from the BTT GitHub/Wiki.

# The command usually looks like:

# PROBE_DRIFT_CALIBRATE PROBE=btt_eddy TARGET=60 STEP=3
# Process:

# The printer will heat the bed.

# It will ask you to perform a "Paper Test" (Manual Z offset) at low temp.

# As the probe heats up (from the bed heat), it will ask you to perform the Paper Test again every few degrees.

# This creates a curve so Z=0 stays Z=0 regardless of how hot the probe is.

# Tip: Do this with your chamber doors closed to simulate real printing heat.

# 4. Final Z-Offset After drift calibration is saved:

# Heat to printing temps.

# G28

# PROBE_CALIBRATE

# Do the paper test one last time.

# SAVE_CONFIG


# Phase 6: Printing Workflow (Start Macro)You must use METHOD=scan and SCAN_MODE=rapid in your start macro to get the speed benefits.Example PRINT_START logic:G-CodeG28 ; Home

# QUAD_GANTRY_LEVEL ; Level Gantry
# G28 Z ; Re-home Z
# BED_MESH_CALIBRATE METHOD=scan SCAN_MODE=rapid ; Fast scan!
# LINE_PURGE ; Purge


# Common Issues & FixesIssueCauseFix
# "MCU 'eddy' disconnect" USB cable loose or poor quality.
# Use a high-quality USB cable. Secure it tightly to the toolhead so the connector doesn't wiggle.
# First layer too high/lowTemperature Drift Calibration not done or invalid.
# Redo the PROBE_DRIFT_CALIBRATE process. 
# Ensure you do it up to the max temp your chamber reaches (e.g., 60Â°C).
# Error: "Timer too close"System overload or USB bandwidth.
# Ensure your Pi isn't overloaded (webcam stream high res?). 
# Use a better USB cable.Probe triggers on magnetsBed magnets too strong/close.
# Do not probe directly over the magnets if possible (adjust mesh min/max).
# Mesh looks like a bowlTwist compensation needed.
# Since the probe is offset, any twist in your X-extrusion looks like bed warp.
#  You may need [axis_twist_compensation].

#  Final Summary Checklist
# [ ] Mount Eddy 2.5mm above nozzle tip.

# [ ] Flash Firmware (USB mode).

# [ ] Configure printer.cfg (Offsets!).

# [ ] Calibrate Current.

# [ ] Calibrate Frequency.

# [ ] Calibrate Temp Drift (Don't skip!).

# [ ] Calibrate Z-Offset.
